Вот полное дерево компонента и коды файлов:
Дерево компонента



/local/components/example/form.result.new
├── /lang
│   └── /ru
│       ├── .description.php
│       └── .parameters.php
├── /templates
│   └── /.default
│       └── template.php
├── .description.php
├── .parameters.php
└── class.php



Код файлов
1. lang/ru/.description.php



php



<?php
if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED !== true) die();

$MESS["FORM_RESULT_NEW_COMPONENT_PATH_ID"] = "local";
$MESS["FORM_RESULT_NEW_COMPONENT_PATH_NAME"] = "Компоненты проекта";
$MESS["FORM_RESULT_NEW_COMPONENT"] = "Обработчик форм (новый)";
$MESS["FORM_RESULT_NEW_COMPONENT_DESCRIPTION"] = "Компонент для обработки веб-форм (новая версия).";
?>



2. lang/ru/.parameters.php



php



<?php if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED !== true) die();

use Bitrix\Main\Localization\Loc;

Loc::loadMessages(__FILE__);
$MESS["WEB_FORM_ID"] = "Выберите ID веб-формы"; 
?>



3. templates/.default/template.php



php



<?php if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED !== true) die(); ?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <link rel="shortcut icon" href="images/favicon.604825ed.ico" type="image/x-icon">
    <link href="/local/components/example/form.result.new/templates/.default/css/common.css" rel="stylesheet">
</head>
<body>
<div class="contact-form">
    <div class="contact-form__head">
        <div class="contact-form__head-title">Связаться</div>
        <div class="contact-form__head-text">Наши сотрудники помогут выполнить подбор услуги и&nbsp;расчет цены с&nbsp;учетом
            ваших требований
        </div>
    </div>
    <form class="contact-form__form" method="post" action="<?= POST_FORM_ACTION_URI ?>">
        <?= bitrix_sessid_post(); ?>
        
        <input type="hidden" name="WEB_FORM_ID" value="<?= htmlspecialchars($arParams['WEB_FORM_ID']) ?>">
        
        <div class="contact-form__form-inputs">
            <div class="input contact-form__input">
                <label class="input__label" for="medicine_name">
                    <div class="input__label-text">Ваше имя*</div>
                    <input class="input__input" type="text" id="medicine_name" name="medicine_name" value="" required="">
                    <div class="input__notification">Поле должно содержать не менее 3-х символов</div>
                </label>
            </div>
            <div class="input contact-form__input">
                <label class="input__label" for="medicine_company">
                    <div class="input__label-text">Компания/Должность*</div>
                    <input class="input__input" type="text" id="medicine_company" name="medicine_company" value="" required="">
                    <div class="input__notification">Поле должно содержать не менее 3-х символов</div>
                </label>
            </div>
            <div class="input contact-form__input">
                <label class="input__label" for="medicine_email">
                    <div class="input__label-text">Email*</div>
                    <input class="input__input" type="email" id="medicine_email" name="medicine_email" value="" required="">
                    <div class="input__notification">Неверный формат почты</div>
                </label>
            </div>
            <div class="input contact-form__input">
                <label class="input__label" for="medicine_phone">
                    <div class="input__label-text">Номер телефона*</div>
                    <input class="input__input" type="text" id="medicine_phone"
                           data-inputmask="'mask': '+79999999999', 'clearIncomplete': 'true'" maxlength="12"
                           x-autocompletetype="phone-full" name="medicine_phone" value="" required="">
                </label>
            </div>
        </div>
        <div class="contact-form__form-message">
            <div class="input">
                <label class="input__label" for="medicine_message">
                    <div class="input__label-text">Сообщение</div>
                    <textarea class="input__input" id="medicine_message" name="medicine_message"></textarea>
                    <div class="input__notification"></div>
                </label>
            </div>
        </div>
        <div class="contact-form__bottom">
            <div class="contact-form__bottom-policy">Нажимая &laquo;Отправить&raquo;, Вы&nbsp;подтверждаете, что
                ознакомлены, полностью согласны и&nbsp;принимаете условия &laquo;Согласия на&nbsp;обработку персональных
                данных&raquo;.
            </div>
            <button class="form-button contact-form__bottom-button" type="submit" data-success="Отправлено"
                    data-error="Ошибка отправки">
                <div class="form-button__title">Оставить заявку</div>
            </button>
        </div>
    </form>
</div>
</body>
</html>



4. .description.php



php



<?php if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED !== true) die();

use Bitrix\Main\Localization\Loc;

$arComponentDescription = [
    "NAME" => Loc::getMessage("FORM_RESULT_NEW_COMPONENT"),
    "DESCRIPTION" => Loc::getMessage("FORM_RESULT_NEW_COMPONENT_DESCRIPTION"),
    "COMPLEX" => "N",
    "PATH" => [
        "ID" => Loc::getMessage("FORM_RESULT_NEW_COMPONENT_PATH_ID"),
        "NAME" => Loc::getMessage("FORM_RESULT_NEW_COMPONENT_PATH_NAME"),
    ],
];
?>



5. .parameters.php



php



<?php if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED !== true) die();

use Bitrix\Main\Localization\Loc;
use Bitrix\Main\Loader;

// Инициализация локализации
// Loc::loadMessages(__FILE__);

// Проверяем, что модуль main установлен
if (!Loader::includeModule('main')) {
    throw new Exception(Loc::getMessage('MAIN_MODULE_NOT_INSTALLED'));
}

// Проверяем, что модуль веб-форм установлен
if (!Loader::includeModule('form')) {
    throw new Exception(Loc::getMessage('FORM_MODULE_NOT_INSTALLED'));
}

// Получаем список веб-форм
$webForms = [];
try {
    // Используем класс CForm для получения списка форм
    $dbForms = CForm::GetList($by = "s_sort", $order = "asc", ["ACTIVE" => "Y"], $is_filtered);
    
    while ($form = $dbForms->Fetch()) {
        $webForms[$form['ID']] = $form['NAME'];
    }

    if (empty($webForms)) {
        $webForms[0] = Loc::getMessage('NO_FORMS_FOUND'); // В случае пустого списка
    }
} catch (Exception $e) {
    file_put_contents($_SERVER['DOCUMENT_ROOT'] . '/log_errors.txt', date('Y-m-d H:i:s') . " - Ошибка получения форм: " . $e->getMessage() . "\n", FILE_APPEND);
    $webForms[0] = 'Ошибка получения форм'; // Установить сообщение об ошибке в качестве варианта в выпадающем списке
}

// Параметры компонента
$arComponentParameters = [
    'PARAMETERS' => [
        'CACHE_TIME' => ['DEFAULT' => 3600],
        'WEB_FORM_ID' => [
            'PARENT' => 'BASE',
            'NAME' => Loc::getMessage('WEB_FORM_ID'),
            'TYPE' => 'LIST',
            'VALUES' => $webForms,
            'DEFAULT' => '',
            'REFRESH' => 'Y'
        ],
    ]
];
?>



6. class.php



php



<?php
if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED !== true) die();

use Bitrix\Main\Localization\Loc;
use Bitrix\Main\Loader;

class CFormResultNew extends CBitrixComponent
{
    public function executeComponent()
    {
        // Проверяем, что модуль веб-форм установлен
        if (!Loader::includeModule('form')) {
            throw new Exception(Loc::getMessage('FORM_MODULE_NOT_INSTALLED'));
        }

        if ($_SERVER["REQUEST_METHOD"] === "POST" && check_bitrix_sessid()) {
            $this->processForm();
        }

        $this->includeComponentTemplate();
    }

    protected function processForm()
    {
        // Логирование входящих данных
        $incomingData = $_POST; // Входящие данные
        $logEntryIn = date('Y-m-d H:i:s') . " IN:\n" . json_encode($incomingData, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) . "\n________\n";
        file_put_contents($_SERVER['DOCUMENT_ROOT'] . '/log_templ.txt', $logEntryIn, FILE_APPEND);

        // Проверяем, что веб-форма выбрана
        if (empty($this->arParams['WEB_FORM_ID'])) {
            return;
        }

        // Проверяем, что все обязательные поля заполнены
        $requiredFields = ['medicine_name', 'medicine_company', 'medicine_email', 'medicine_phone'];
        foreach ($requiredFields as $field) {
            if (empty($incomingData[$field])) {
                $outgoingData = [
                    'status' => 'error',
                    'message' => "Поле '{$field}' обязательно для заполнения."
                ];
                // Логируем ошибку
                $logEntryError = date('Y-m-d H:i:s') . " ERROR:\n" . json_encode($outgoingData, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) . "\n________\n";
                file_put_contents($_SERVER['DOCUMENT_ROOT'] . '/log_templ.txt', $logEntryError, FILE_APPEND);
                return;
            }
        }

        // Подготовка массива значений ответов без префиксов
        $arValues = [
            "medicine_name" => $incomingData['medicine_name'],
            "medicine_company" => $incomingData['medicine_company'],
            "medicine_email" => $incomingData['medicine_email'],
            "medicine_phone" => $incomingData['medicine_phone'],
            "medicine_message" => $incomingData['medicine_message'],
        ];

        // Логирование массива значений перед добавлением
        $logEntryValues = date('Y-m-d H:i:s') . " VALUES:\n" . json_encode($arValues, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) . "\n________\n";
        file_put_contents($_SERVER['DOCUMENT_ROOT'] . '/log_templ.txt', $logEntryValues, FILE_APPEND);

        // Создаем новый результат формы
        $resultId = CFormResult::Add($this->arParams['WEB_FORM_ID'], $arValues);

        if ($resultId) {
            // Успешно добавлено
            $outgoingData = [
                'status' => 'success',
                'message' => 'Форма успешно обработана. ID результата: ' . $resultId
            ];
        } else {
            // Ошибка при добавлении
            global $APPLICATION;
            $error = $APPLICATION->GetException();
            $errorMessage = $error ? $error->GetString() : 'Неизвестная ошибка при добавлении результата.';
            
            // Логируем ошибку с дополнительной информацией
            $logEntryError = date('Y-m-d H:i:s') . " ERROR:\n" . json_encode(['status' => 'error', 'message' => $errorMessage, 'arValues' => $arValues], JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) . "\n________\n";
            file_put_contents($_SERVER['DOCUMENT_ROOT'] . '/log_templ.txt', $logEntryError, FILE_APPEND);

            $outgoingData = [
                'status' => 'error',
                'message' => 'Ошибка при обработке формы: ' . $errorMessage
            ];
        }

        // Логирование исходящих данных
        $logEntryOut = date('Y-m-d H:i:s') . " OUT:\n" . json_encode($outgoingData, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) . "\nAR_VALUES:\n" . json_encode($arValues, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) . "\n________\n";
        file_put_contents($_SERVER['DOCUMENT_ROOT'] . '/log_templ.txt', $logEntryOut, FILE_APPEND);
    }
}
?>


